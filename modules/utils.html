<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <link rel="apple-touch-icon" sizes="57x57" href="../assets//favicon/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="../assets//favicon/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="../assets//favicon/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="../assets//favicon/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="../assets//favicon/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="../assets//favicon/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="../assets//favicon/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="../assets//favicon/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="../assets//favicon/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="../assets//favicon/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="../assets//favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="../assets//favicon/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="../assets//favicon/favicon-16x16.png">
  <link rel="manifest" href="../assets//favicon/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content=""../assets//favicon/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">

  <title>MicroBase Â· eCommerce made simple</title>

  <link href="../assets//css/bootstrap.css" rel="stylesheet">
  <link href="../assets//css/overwrites.css" rel="stylesheet">
  <link href="../assets//css/main.css" rel="stylesheet">
  <link href="../assets//fonts/pictoicons/css/picto.css" rel="stylesheet">
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.5.0/styles/tomorrow.min.css">

  <link href='https://fonts.googleapis.com/css?family=Lato:300,400,900' rel='stylesheet' type='text/css'>

  <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
  <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
  <![endif]-->

  <script>
    (function (i, s, o, g, r, a, m) {
      i['GoogleAnalyticsObject'] = r;
      i[r] = i[r] || function () {
          (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date();
      a = s.createElement(o),
        m = s.getElementsByTagName(o)[0];
      a.async = 1;
      a.src = g;
      m.parentNode.insertBefore(a, m)
    })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-88562993-1', 'auto');
    ga('send', 'pageview');

  </script>

</head>

<body class="white">

<!-- Fixed navbar -->
<div class="header navbar navbar-default navbar-fixed-top">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse"
              data-target=".navbar-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="http://microbase.io"><img
          src="../assets//img/logo.png" alt="MICRO-BASE"/></a>
    </div>
    <div class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
        <li><a href="http://docs.microbase.io">See the docs <strong style="margin-left:5px"><i class="fa fa-book" style="color: #00aced"></i></strong> &gt;</a></li>
      </ul>
    </div><!--/.nav-collapse -->
  </div>
</div>
<div class="page-content">
  <div class="container">
    <nav class="col-xs-3">
      <ul>
        <li><a href="../index.html">Overview</a></li>
      </ul>
      <ul>
        <li><a href="../services/ecomm-setup.html">Setup</a></li>
      </ul>
      <ul>
        <li><a href="../services/base-examples.html">Examples</a></li>
      </ul>
      <ul>
        <li><a href="../services/fakeData.html">Fake Data</a></li>
      </ul>
      ________________________
      <h3>Utils module TOC</h3><ul>
  <li><a href="#utils-module">Utils module</a></li>
  <li><a href="#loadmodulefromfile">loadModuleFromFile</a></li>
  <li><a href="#loadmodulesfromfolder">loadModulesFromFolder</a></li>
  <li><a href="#loadmodulefromkey">loadModuleFromKey</a></li>
  <li><a href="#loadmodulesfromkey">loadModulesFromKey</a></li>
  <li><a href="#error">Error</a></li>
  <li><a href="#genericresponse">genericResponse</a></li>
  <li><a href="#chain">Chain</a></li>
  <li><a href="#evaluator">Evaluator</a></li>
</ul>      ________________________

      <h3>Services</h3>
      <ul>
        <li><a href="../services/micro-cart-service.html">Cart</a></li>
        <li><a href="../services/micro-catalog-service.html">Catalog</a></li>
        <li><a href="../services/micro-customer-service.html">Customer</a></li>
        <li><a href="../services/micro-oauth-service.html">Oauth</a></li>
        <li><a href="../services/micro-payment-service.html">Payment</a></li>
        <li><a href="../services/micro-promotion-service.html">Promotion</a></li>
        <li><a href="../services/micro-recommendation-service.html">Recommendation</a></li>
        <li><a href="../services/micro-stock-service.html">Stock</a></li>
        <li><a href="../services/micro-tax-service.html">Tax</a></li>
      </ul>
      <h3>API</h3>
      <ul>
        <li><a href="../api/calling-conventions.html">Calling conventions</a>
          
        <li><a href="../api/cart.addToCart.html">cart.addToCart</a>
          <a href="../api/v1/cart.addToCart.html">[v1]</a>
        <li><a href="../api/cart.calculateCart.html">cart.calculateCart</a>
          <a href="../api/v1/cart.calculateCart.html">[v1]</a>
        <li><a href="../api/cart.checkout.html">cart.checkout</a>
          <a href="../api/v1/cart.checkout.html">[v1]</a>
        <li><a href="../api/cart.create.html">cart.create</a>
          <a href="../api/v1/cart.create.html">[v1]</a>
        <li><a href="../api/cart.info.html">cart.info</a>
          <a href="../api/v1/cart.info.html">[v1]</a>
        <li><a href="../api/cart.list.html">cart.list</a>
          
        <li><a href="../api/cart.removeFromCart.html">cart.removeFromCart</a>
          <a href="../api/v1/cart.removeFromCart.html">[v1]</a>
        <li><a href="../api/cart.setBillingAddress.html">cart.setBillingAddress</a>
          <a href="../api/v1/cart.setBillingAddress.html">[v1]</a>
        <li><a href="../api/cart.setPaymentGateway.html">cart.setPaymentGateway</a>
          <a href="../api/v1/cart.setPaymentGateway.html">[v1]</a>
        <li><a href="../api/cart.setShippingAddress.html">cart.setShippingAddress</a>
          <a href="../api/v1/cart.setShippingAddress.html">[v1]</a>
        <li><a href="../api/cart.setShippingMethod.html">cart.setShippingMethod</a>
          <a href="../api/v1/cart.setShippingMethod.html">[v1]</a>
        <li><a href="../api/category.create.html">category.create</a>
          <a href="../api/v1/category.create.html">[v1]</a>
        <li><a href="../api/category.info.html">category.info</a>
          <a href="../api/v1/category.info.html">[v1]</a>
        <li><a href="../api/category.list.html">category.list</a>
          <a href="../api/v1/category.list.html">[v1]</a>
        <li><a href="../api/category.remove.html">category.remove</a>
          <a href="../api/v1/category.remove.html">[v1]</a>
        <li><a href="../api/category.update.html">category.update</a>
          <a href="../api/v1/category.update.html">[v1]</a>
        <li><a href="../api/customer.address.create.html">customer.address.create</a>
          
        <li><a href="../api/customer.address.info.html">customer.address.info</a>
          
        <li><a href="../api/customer.address.remove.html">customer.address.remove</a>
          
        <li><a href="../api/customer.address.update.html">customer.address.update</a>
          
        <li><a href="../api/customer.checkCredentials.html">customer.checkCredentials</a>
          
        <li><a href="../api/customer.create.html">customer.create</a>
          
        <li><a href="../api/customer.info.html">customer.info</a>
          
        <li><a href="../api/customer.list.html">customer.list</a>
          
        <li><a href="../api/customer.remove.html">customer.remove</a>
          
        <li><a href="../api/customer.update.html">customer.update</a>
          
        <li><a href="../api/payment.authorize.html">payment.authorize</a>
          
        <li><a href="../api/payment.capture.html">payment.capture</a>
          
        <li><a href="../api/payment.create.html">payment.create</a>
          
        <li><a href="../api/payment.info.html">payment.info</a>
          
        <li><a href="../api/payment.list.html">payment.list</a>
          
        <li><a href="../api/payment.purchase.html">payment.purchase</a>
          
        <li><a href="../api/payment.remove.html">payment.remove</a>
          
        <li><a href="../api/payment.token.html">payment.token</a>
          
        <li><a href="../api/payment.update.html">payment.update</a>
          
        <li><a href="../api/product.create.html">product.create</a>
          <a href="../api/v1/product.create.html">[v1]</a>
        <li><a href="../api/product.info.html">product.info</a>
          <a href="../api/v1/product.info.html">[v1]</a>
        <li><a href="../api/product.list.html">product.list</a>
          <a href="../api/v1/product.list.html">[v1]</a>
        <li><a href="../api/product.remove.html">product.remove</a>
          <a href="../api/v1/product.remove.html">[v1]</a>
        <li><a href="../api/product.update.html">product.update</a>
          <a href="../api/v1/product.update.html">[v1]</a>
        <li><a href="../api/promotion.cartPromotions.html">promotion.cartPromotions</a>
          <a href="../api/v1/promotion.cartPromotions.html">[v1]</a>
        <li><a href="../api/promotion.create.html">promotion.create</a>
          <a href="../api/v1/promotion.create.html">[v1]</a>
        <li><a href="../api/promotion.remove.html">promotion.remove</a>
          <a href="../api/v1/promotion.remove.html">[v1]</a>
        <li><a href="../api/recommendation.alsoviewed.html">recommendation.alsoviewed</a>
          
        <li><a href="../api/shipping.create.html">shipping.create</a>
          
        <li><a href="../api/shipping.getShippingMethods.html">shipping.getShippingMethods</a>
          
        <li><a href="../api/shipping.info.html">shipping.info</a>
          
        <li><a href="../api/shipping.remove.html">shipping.remove</a>
          
        <li><a href="../api/stock.create.html">stock.create</a>
          
        <li><a href="../api/stock.info.html">stock.info</a>
          
        <li><a href="../api/stock.remove.html">stock.remove</a>
          
        <li><a href="../api/stock.reserve.html">stock.reserve</a>
          
        <li><a href="../api/stock.reserve.renew.html">stock.reserve.renew</a>
          
        <li><a href="../api/stock.unreserve.html">stock.unreserve</a>
          
        <li><a href="../api/stock.update.html">stock.update</a>
          
        <li><a href="../api/tax.cartTaxes.html">tax.cartTaxes</a>
          <a href="../api/v1/tax.cartTaxes.html">[v1]</a>
        <li><a href="../api/tax.create.html">tax.create</a>
          <a href="../api/v1/tax.create.html">[v1]</a>
        <li><a href="../api/tax.info.html">tax.info</a>
          <a href="../api/v1/tax.info.html">[v1]</a>
        <li><a href="../api/tax.list.html">tax.list</a>
          <a href="../api/v1/tax.list.html">[v1]</a>
        <li><a href="../api/tax.remove.html">tax.remove</a>
          <a href="../api/v1/tax.remove.html">[v1]</a>
        <li><a href="../api/tax.update.html">tax.update</a>
          <a href="../api/v1/tax.update.html">[v1]</a>
      </ul>
      <h3>Base Modules</h3>
      <ul>
        <li><a href="admin.html">Admin</a></li>
        <li><a href="bus.html">Bus</a></li>
        <li><a href="cache.html">Cache</a></li>
        <li><a href="config.html">Config</a></li>
        <li><a href="db.html">DB</a></li>
        <li><a href="impex.html">Impex</a></li>
        <li><a href="logger.html">Logger</a></li>
        <li><a href="logstash.html">Logstash</a></li>
        <li><a href="migrations.html">Migrations</a></li>
        <li><a href="probes.html">Probes</a></li>
        <li><a href="search.html">Search</a></li>
        <li><a href="services.html">Services</a></li>
        <li><a href="tokens.html">Tokens</a></li>
        <li><a href="transports.html">Transports</a></li>
        <li><a href="utils.html">Utils</a></li>
        <li><a href="workers.html">Workers</a></li>
      </ul>
    </nav>
    <div class="col-xs-9"><h1 id="utils-module">Utils module</h1>
<p>This module contains a bunch of utility methods to be used in the application.</p>
<h1 id="loadmodulefromfile">loadModuleFromFile</h1>
<p>Loads a module from a file with <code>require</code>. It asumes that is a Microbase
module so it initializes it with <code>module(base)</code> if it&#39;s a function, or
<code>new module(base)</code> if it&#39;s a class.</p>
<pre class="hljs"><code><span class="hljs-keyword">const</span> <span class="hljs-built_in">module</span> = base.utils.loadModuleFromFile(<span class="hljs-string">'/afolder/test.js'</span>);
<span class="hljs-built_in">console</span>.log(<span class="hljs-built_in">module</span>);</code></pre><p>In any case it returns an object with the created module and the resolver file.</p>
<pre class="hljs"><code>{ module: [Function],
  filePath: '/afolder/test.js' }</code></pre><p>If the filename starts with a dot, the file is relative to the application root.</p>
<pre class="hljs"><code><span class="hljs-keyword">const</span> <span class="hljs-built_in">module</span> = base.utils.loadModuleFromFile(<span class="hljs-string">'./afolder/test.js'</span>);
<span class="hljs-built_in">console</span>.log(<span class="hljs-built_in">module</span>);</code></pre><pre class="hljs"><code>{ module: [Function],
  filePath: '/projectFolder/afolder/test.js' }</code></pre><p>It also support config variables in the argument.</p>
<pre class="hljs"><code><span class="hljs-keyword">const</span> <span class="hljs-built_in">module</span> = base.utils.loadModuleFromFile(<span class="hljs-string">'${basepath}/afolder/test.js'</span>);
<span class="hljs-built_in">console</span>.log(<span class="hljs-built_in">module</span>);</code></pre><pre class="hljs"><code>{ module: [Function],
  filePath: '/projectFolder/node_modules/microbase/afolder/test.js' }</code></pre><h1 id="loadmodulesfromfolder">loadModulesFromFolder</h1>
<p>Utilizes <code>loadModuleFromFile</code> with all <code>*.js</code> files in a folder. Returns an array
with the modules loaded.</p>
<pre class="hljs"><code><span class="hljs-keyword">const</span> modules = base.utils.loadModulesFromFolder(<span class="hljs-string">'./afolder'</span>);
<span class="hljs-built_in">console</span>.log(<span class="hljs-built_in">module</span>);</code></pre><pre class="hljs"><code>[ { module: [Function],
    filePath: '/projectFolder/afolder/test.js' },
  { module: [Function],
    filePath: '/projectFolder/afolder/anotherTest.js' } ]</code></pre><h1 id="loadmodulefromkey">loadModuleFromKey</h1>
<p>Loads a module with <code>loadModuleFromFile</code>, but taking the filename from a 
configuration key.</p>
<p>Given this config file:</p>
<pre class="hljs"><code>{
  <span class="hljs-attr">"myapp"</span>: {
    <span class="hljs-attr">"mymodulelocation"</span>: <span class="hljs-string">"./afolder/test.js"</span>
  }
}</code></pre><pre class="hljs"><code><span class="hljs-keyword">const</span> <span class="hljs-built_in">module</span> = base.utils.loadModuleFromKey(<span class="hljs-string">'myapp:mymodulelocation'</span>);
<span class="hljs-built_in">console</span>.log(<span class="hljs-built_in">module</span>);</code></pre><pre class="hljs"><code>{ module: [Function],
  filePath: '/projectFolder/afolder/test.js' }</code></pre><h1 id="loadmodulesfromkey">loadModulesFromKey</h1>
<p>Utilizes <code>loadModuleFromKey</code> to load all modules from an object in a
configuration key.</p>
<p>Given this config file:</p>
<pre class="hljs"><code>{
  <span class="hljs-attr">"mymoduleslocation"</span>: {
    <span class="hljs-attr">"filea"</span>: <span class="hljs-string">"./afolder/test.js"</span>,
    <span class="hljs-attr">"fileb"</span>: <span class="hljs-string">"./afolder/anotherTest.js"</span>
  }
}</code></pre><pre class="hljs"><code><span class="hljs-keyword">const</span> <span class="hljs-built_in">module</span> = base.utils.loadModuleFromKey(<span class="hljs-string">'mymodulelocation'</span>);
<span class="hljs-built_in">console</span>.log(<span class="hljs-built_in">module</span>);</code></pre><pre class="hljs"><code>[ { module: [Function],
    filePath: '/projectFolder/afolder/test.js' },
  { module: [Function],
    filePath: '/projectFolder/afolder/anotherTest.js' } ]</code></pre><h1 id="error">Error</h1>
<p>Returns an object representingg an error to be returned in a service call. The
first argument is the error code, and the second the associated data.</p>
<pre class="hljs"><code><span class="hljs-keyword">if</span> (response.ok === <span class="hljs-literal">false</span>) 
  <span class="hljs-keyword">throw</span> base.utils.Error(<span class="hljs-string">'tax_not_found'</span>, tax.id, <span class="hljs-literal">true</span>);
}</code></pre><h1 id="genericresponse">genericResponse</h1>
<p>Returns an object representing a response to be returned in a service call. The
first argument is the payload and the second the error, if any.</p>
<p>If there is an error the property <code>ok</code> will be set to <code>false</code> otherwise it will
be set to <code>true</code>.</p>
<pre class="hljs"><code>{ <span class="hljs-attr">"ok"</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">"methods"</span>:
   [ { <span class="hljs-attr">"id"</span>: <span class="hljs-string">"S1C4E9Jfi0f"</span>,
       <span class="hljs-attr">"title"</span>: <span class="hljs-string">"UPS Same Day"</span>,
       <span class="hljs-attr">"taxCode"</span>: <span class="hljs-string">"default"</span>,
       <span class="hljs-attr">"rateId"</span>: <span class="hljs-string">"ryT4Nq1Go0G"</span>
     } 
   ] 
}
</code></pre><pre class="hljs"><code>{ 
  <span class="hljs-attr">"ok"</span>: <span class="hljs-literal">false</span>,
  <span class="hljs-attr">"error"</span>: <span class="hljs-string">"validation_error"</span>,
  <span class="hljs-attr">"data"</span>: [ <span class="hljs-string">"payload: should have required property 'lastName'"</span> ] 
}
</code></pre><h1 id="chain">Chain</h1>
<p>Chain of Responsibility implementation.</p>
<p>Each module in the chain returns a function that receives a shared <code>context</code> 
and a <code>next</code> function to continue to the next module:</p>
<pre class="hljs"><code><span class="hljs-built_in">module</span>.exports = (base) =&gt; {
  <span class="hljs-keyword">return</span> (context, next) =&gt; {
    <span class="hljs-keyword">if</span> (context.newData.id !== <span class="hljs-string">'99'</span>) {
      <span class="hljs-keyword">return</span> next()
    }
    <span class="hljs-keyword">return</span> next(base.utils.Error(<span class="hljs-string">'code_invalid'</span>, context.newData.id));
  };
}</code></pre><p>To instantiate and execute the chain, you need to <code>use</code> a config key whith the ordered
list of the modules to be execute:</p>
<pre class="hljs"><code><span class="hljs-keyword">const</span> createProductChain = <span class="hljs-keyword">new</span> base.utils.Chain(base).use(<span class="hljs-string">'createProductChain'</span>);
<span class="hljs-keyword">const</span> ctx = {
  newData: {
    id: <span class="hljs-string">'001'</span>
  }
};
<span class="hljs-keyword">this</span>.createProductChain
  .exec(ctx)
  .then(() =&gt; reply(<span class="hljs-keyword">this</span>.base.utils.genericResponse({ product: ctx.savedProduct.toClient() })))
  .catch(error =&gt; reply(<span class="hljs-keyword">this</span>.base.utils.genericResponse(<span class="hljs-literal">null</span>, error)));</code></pre><p>The config key contains the filenames of the modules:</p>
<pre class="hljs"><code><span class="hljs-string">"createProductChain"</span>: {
  <span class="hljs-attr">"checkPrices"</span>: <span class="hljs-string">"./operations/chains/createProduct/checkPrices"</span>,
  <span class="hljs-attr">"checkCategories"</span>: <span class="hljs-string">"./operations/chains/createProduct/checkCategories"</span>,
  <span class="hljs-attr">"checkClassifications"</span>: <span class="hljs-string">"./operations/chains/createProduct/checkClassifications"</span>,
  <span class="hljs-attr">"checkVariants"</span>: <span class="hljs-string">"./operations/chains/createProduct/checkVariants"</span>,
  <span class="hljs-attr">"saveProduct"</span>: <span class="hljs-string">"./operations/chains/createProduct/saveProduct"</span>,
  <span class="hljs-attr">"postSaveProduct"</span>: <span class="hljs-string">"./operations/chains/createProduct/postSaveProduct"</span>
}</code></pre><h1 id="evaluator">Evaluator</h1>
<p>JSON evaluator with pluggable functions.</p>
<p>Take a look at the <code>evaluator</code> example in the <code>examples</code> folder or dig into the 
<code>micro-promotions-service</code> ecomm service.</p>
<pre class="hljs"><code><span class="hljs-keyword">const</span> rulesEvaluator = <span class="hljs-keyword">new</span> base.utils.Evaluator(base).use(<span class="hljs-string">'promotions:default:rules'</span>);
<span class="hljs-keyword">const</span> result = rulesEvaluator.evaluate(context, opContext, <span class="hljs-number">0</span>, context.promotion.if);</code></pre>    </div>
  </div>
</div>


<div class="footer container">
  <p class="centered">&copy; MicroBase <?php echo date("Y"); ?></p>
</div><!-- /container -->

<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
<script src="../assets//js/bootstrap.min.js"></script>
<!-- highlightjs -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.5.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

</body>
</html>
